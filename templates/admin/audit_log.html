{% extends "admin/layout.html" %}

{% block admin_content %}
<div class="admin-page-header">
    <div>
        <h1 class="admin-page-title">Audit Log</h1>
        <p class="admin-page-subtitle">{{ total }} total entries &middot; Page {{ page }} of {{ total_pages }}</p>
    </div>
</div>

{% if entries %}
<div class="a-table-wrap" style="overflow-x: auto;">
    <table class="a-table" style="min-width: 800px;">
        <thead>
            <tr>
                <th style="width: 145px;">Timestamp</th>
                <th style="width: 160px;">Admin</th>
                <th style="width: 130px;">Action</th>
                <th style="width: 150px;">Target</th>
                <th>Details</th>
                <th style="width: 110px;">IP</th>
            </tr>
        </thead>
        <tbody>
            {% for e in entries %}
            <tr>
                <td style="font-size: 0.78rem; color: var(--fg-secondary); white-space: nowrap;">
                    {% if e.timestamp %}{{ e.timestamp | localtime(True) }}{% endif %}
                </td>
                <td style="word-break: break-all;"><strong style="font-size: 0.85rem;">{{ e.admin_email }}</strong></td>
                <td>
                    {% if 'delete' in e.action or 'ban' in e.action %}
                    <span class="a-badge a-badge-danger">{{ e.action }}</span>
                    {% elif 'impersonate' in e.action %}
                    <span class="a-badge a-badge-warning">{{ e.action }}</span>
                    {% elif 'backup' in e.action or 'export' in e.action %}
                    <span class="a-badge a-badge-success">{{ e.action }}</span>
                    {% else %}
                    <span class="a-badge a-badge-info">{{ e.action }}</span>
                    {% endif %}
                </td>
                <td style="font-size: 0.85rem; color: var(--fg-secondary); word-break: break-all;">{{ e.target or '-' }}</td>
                <td style="font-size: 0.78rem; color: var(--fg-secondary); word-break: break-word;" title="{{ e.details or '' }}">
                    {{ e.details or '-' }}
                </td>
                <td style="font-size: 0.78rem; font-family: 'IBM Plex Mono', monospace; color: var(--fg-secondary); white-space: nowrap;">{{ e.ip_address or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="a-pagination">
    {% if page > 1 %}
    <a href="?page={{ page - 1 }}"><i class="fas fa-chevron-left"></i></a>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
        <span class="active">{{ p }}</span>
        {% elif p <= 3 or p > total_pages - 2 or (p >= page - 1 and p <= page + 1) %}
        <a href="?page={{ p }}">{{ p }}</a>
        {% elif p == 4 and page > 5 %}
        <span style="border: none; background: none; color: var(--fg-secondary);">...</span>
        {% elif p == total_pages - 2 and page < total_pages - 4 %}
        <span style="border: none; background: none; color: var(--fg-secondary);">...</span>
        {% endif %}
    {% endfor %}

    {% if page < total_pages %}
    <a href="?page={{ page + 1 }}"><i class="fas fa-chevron-right"></i></a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="a-card-flat">
    <div class="a-empty">
        <i class="fas fa-scroll"></i>
        <p>No audit entries yet. Admin actions will be logged here automatically.</p>
    </div>
</div>
{% endif %}
{% endblock %}
