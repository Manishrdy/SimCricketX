{% extends "admin/layout.html" %}

{% block admin_content %}
<div class="admin-page-header">
    <div>
        <h1 class="admin-page-title">Database</h1>
        <p class="admin-page-subtitle">Statistics and maintenance</p>
    </div>
    <div class="admin-page-actions">
        <button onclick="downloadDatabase()" class="a-btn a-btn-primary"><i class="fas fa-download"></i> Download Backup</button>
    </div>
</div>

<div class="a-stats-grid">
    <div class="a-stat-card">
        <div class="a-stat-icon"><i class="fas fa-weight-hanging"></i></div>
        <div class="a-stat-label">Database Size</div>
        <div class="a-stat-value">{{ stats.db_size_mb }}</div>
        <div class="a-stat-sub">MB</div>
    </div>
    <div class="a-stat-card">
        <div class="a-stat-icon"><i class="fas fa-table"></i></div>
        <div class="a-stat-label">Tables</div>
        <div class="a-stat-value">{{ stats.total_tables }}</div>
    </div>
    <div class="a-stat-card">
        <div class="a-stat-icon"><i class="fas fa-users"></i></div>
        <div class="a-stat-label">Users</div>
        <div class="a-stat-value">{{ stats.total_users }}</div>
    </div>
    <div class="a-stat-card">
        <div class="a-stat-icon"><i class="fas fa-layer-group"></i></div>
        <div class="a-stat-label">Teams</div>
        <div class="a-stat-value">{{ stats.total_teams }}</div>
    </div>
    <div class="a-stat-card">
        <div class="a-stat-icon"><i class="fas fa-baseball-ball"></i></div>
        <div class="a-stat-label">Matches</div>
        <div class="a-stat-value">{{ stats.total_matches }}</div>
    </div>
    <div class="a-stat-card">
        <div class="a-stat-icon"><i class="fas fa-trophy"></i></div>
        <div class="a-stat-label">Tournaments</div>
        <div class="a-stat-value">{{ stats.total_tournaments }}</div>
    </div>
</div>

<div class="a-section">
    <h3 class="a-section-title"><i class="fas fa-wrench"></i> Maintenance</h3>
    <div class="a-card-flat">
        <p style="color: var(--fg-secondary); font-size: 0.88rem; margin-bottom: 1rem;">
            VACUUM reclaims unused space and defragments the database file.
        </p>
        <button onclick="optimizeDatabase()" class="a-btn a-btn-primary" id="vacuumBtn">
            <i class="fas fa-wrench"></i> Optimize Database (VACUUM)
        </button>
    </div>
</div>

<script>
async function optimizeDatabase() {
    if (!confirm('Optimize the database? This may take a moment.')) return;
    const btn = document.getElementById('vacuumBtn');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Optimizing...';
    try {
        const resp = await fetch('/admin/database/optimize', { method: 'POST' });
        const data = await resp.json();
        if (resp.ok) { alert('Database optimized successfully!'); window.location.reload(); }
        else alert('Failed: ' + (data.error || 'Unknown error'));
    } catch { alert('Network error'); }
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-wrench"></i> Optimize Database (VACUUM)';
}
</script>
{% endblock %}
