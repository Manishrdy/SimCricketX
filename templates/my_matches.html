{% extends "layout.html" %}

{% block title %}My Matches | SimCricketX{% endblock %}

{% block extra_css %}
<style>
    /* ========== HERO ========== */
    .matches-hero {
        position: relative;
        padding: 3.5rem 0 2.5rem;
        margin-bottom: 2rem;
        overflow: hidden;
    }

    .matches-hero::before {
        content: '';
        position: absolute;
        inset: 0;
        background:
            radial-gradient(ellipse at 20% 50%, rgba(34, 139, 34, 0.05) 0%, transparent 60%),
            radial-gradient(ellipse at 85% 30%, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
        pointer-events: none;
    }

    /* Decorative cricket field lines */
    .matches-hero::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 600px;
        height: 600px;
        border-radius: 50%;
        border: 2px solid var(--card-border);
        opacity: 0.08;
        pointer-events: none;
    }

    .hero-deco-ball {
        position: absolute;
        top: 15%;
        right: 4%;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: radial-gradient(circle at 35% 35%, #DC143C, #8B0000);
        opacity: 0.08;
        animation: heroBallFloat 7s ease-in-out infinite;
        pointer-events: none;
    }

    .hero-deco-ball::before {
        content: '';
        position: absolute;
        top: 12px;
        left: 5px;
        right: 5px;
        height: 1.5px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 50%;
        transform: rotate(15deg);
    }

    @keyframes heroBallFloat {

        0%,
        100% {
            transform: translateY(0) rotate(0deg);
        }

        50% {
            transform: translateY(-14px) rotate(180deg);
        }
    }

    .hero-row {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        gap: 2rem;
        position: relative;
        z-index: 1;
    }

    .hero-text h1 {
        font-size: 2.8rem;
        font-weight: 900;
        background: var(--gradient);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        line-height: 1.1;
        letter-spacing: -0.03em;
        margin-bottom: 0.5rem;
    }

    .hero-text p {
        color: var(--fg-secondary);
        font-size: 1.05rem;
        max-width: 480px;
        line-height: 1.6;
    }

    /* ========== STAT PILLS ========== */
    .stat-pills {
        display: flex;
        gap: 1rem;
        flex-shrink: 0;
    }

    .stat-pill {
        background: var(--card-bg);
        border: 2px solid var(--card-border);
        border-radius: 16px;
        padding: 1rem 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        min-width: 130px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-pill::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, var(--accent-light) 0%, transparent 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .stat-pill:hover {
        border-color: var(--accent);
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

    .stat-pill:hover::before {
        opacity: 1;
    }

    .stat-pill .pill-value {
        font-size: 2rem;
        font-weight: 900;
        font-family: 'IBM Plex Mono', monospace;
        background: var(--gradient);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        line-height: 1;
        position: relative;
    }

    .stat-pill .pill-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--fg-secondary);
        font-weight: 600;
        position: relative;
    }

    /* ========== TOOLBAR (tabs + search) ========== */
    .toolbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1.75rem;
        flex-wrap: wrap;
    }

    /* Tab Bar with sliding indicator */
    .tab-bar {
        display: flex;
        background: var(--card-bg);
        border: 2px solid var(--card-border);
        border-radius: 14px;
        padding: 4px;
        position: relative;
    }

    .tab-indicator {
        position: absolute;
        top: 4px;
        left: 4px;
        height: calc(100% - 8px);
        border-radius: 11px;
        background: var(--accent);
        transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
    }

    [data-theme="dark"] .tab-indicator {
        box-shadow: 0 2px 12px rgba(97, 175, 239, 0.25);
    }

    .tab-item {
        position: relative;
        z-index: 1;
        border: none;
        background: transparent;
        padding: 0.6rem 1.4rem;
        font-size: 0.88rem;
        font-weight: 700;
        color: var(--fg-secondary);
        border-radius: 11px;
        cursor: pointer;
        transition: color 0.25s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        white-space: nowrap;
    }

    .tab-item:hover {
        color: var(--fg);
    }

    .tab-item.active {
        color: #fff;
    }

    .tab-badge {
        font-size: 0.68rem;
        font-weight: 700;
        background: rgba(255, 255, 255, 0.2);
        padding: 1px 7px;
        border-radius: 8px;
        line-height: 1.5;
    }

    .tab-item:not(.active) .tab-badge {
        background: var(--accent-light);
        color: var(--accent);
    }

    /* Search Bar */
    .search-box {
        position: relative;
        width: 260px;
    }

    .search-box input {
        width: 100%;
        padding: 0.55rem 0.9rem 0.55rem 2.3rem;
        border: 2px solid var(--card-border);
        border-radius: 11px;
        background: var(--card-bg);
        color: var(--fg);
        font-size: 0.85rem;
        font-family: inherit;
        font-weight: 500;
        transition: all 0.25s ease;
        outline: none;
    }

    .search-box input::placeholder {
        color: var(--fg-secondary);
        opacity: 0.6;
    }

    .search-box input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-light);
    }

    .search-box .search-icon {
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--fg-secondary);
        font-size: 0.78rem;
        opacity: 0.6;
        pointer-events: none;
    }

    .search-box .clear-search {
        position: absolute;
        right: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        border: none;
        background: none;
        color: var(--fg-secondary);
        font-size: 0.75rem;
        cursor: pointer;
        padding: 4px;
        border-radius: 6px;
        display: none;
        transition: color 0.2s;
    }

    .search-box .clear-search:hover {
        color: var(--fg);
    }

    .search-box.has-query .clear-search {
        display: block;
    }

    /* ========== PANELS ========== */
    .panel {
        display: none;
        animation: panelIn 0.3s ease;
    }

    .panel.active {
        display: block;
    }

    @keyframes panelIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ========== MATCH CARDS ========== */
    .match-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 1.25rem;
    }

    .match-card {
        background: var(--card-bg);
        border: 2px solid var(--card-border);
        border-radius: 20px;
        overflow: hidden;
        transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    .match-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .match-card:hover {
        border-color: var(--accent);
        transform: translateY(-5px);
        box-shadow:
            0 20px 50px rgba(0, 0, 0, 0.1),
            0 0 0 1px var(--accent);
    }

    .match-card:hover::before {
        transform: scaleX(1);
    }

    .match-card-body {
        padding: 1.25rem 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.85rem;
    }

    /* Teams & Date Row */
    .match-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 0.5rem;
    }

    .match-teams {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--fg);
        line-height: 1.3;
    }

    .match-teams .vs {
        color: var(--fg-secondary);
        font-weight: 400;
        font-size: 0.78rem;
        margin: 0 0.35rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .match-date-chip {
        font-size: 0.72rem;
        color: var(--fg-secondary);
        font-weight: 600;
        white-space: nowrap;
        background: var(--bg-secondary);
        padding: 3px 9px;
        border-radius: 7px;
        display: flex;
        align-items: center;
        gap: 0.35rem;
        flex-shrink: 0;
    }

    /* Score Comparison Block */
    .score-block {
        background: var(--bg-secondary);
        border: 1px solid var(--card-border);
        border-radius: 14px;
        overflow: hidden;
    }

    .score-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.6rem 1rem;
        transition: background 0.2s ease;
    }

    .score-row+.score-row {
        border-top: 1px solid var(--card-border);
    }

    .score-row:hover {
        background: var(--accent-light);
    }

    .score-team-name {
        font-size: 0.82rem;
        font-weight: 700;
        color: var(--fg);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .team-initial {
        width: 26px;
        height: 26px;
        border-radius: 8px;
        background: var(--gradient);
        color: #fff;
        font-size: 0.65rem;
        font-weight: 800;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        letter-spacing: -0.02em;
    }

    .score-figures {
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.88rem;
        font-weight: 700;
        color: var(--fg);
        display: flex;
        align-items: baseline;
        gap: 0.4rem;
    }

    .score-overs {
        font-size: 0.72rem;
        font-weight: 500;
        color: var(--fg-secondary);
    }

    /* Result */
    .match-result {
        font-size: 0.82rem;
        color: var(--fg-secondary);
        line-height: 1.5;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .result-dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--accent);
        flex-shrink: 0;
        box-shadow: 0 0 6px var(--accent);
    }

    /* Footer */
    .match-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        padding: 0.75rem 1.5rem;
        border-top: 1px solid var(--card-border);
        background: color-mix(in srgb, var(--bg-secondary) 50%, transparent);
    }

    .match-id {
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.7rem;
        color: var(--fg-secondary);
        opacity: 0.6;
    }

    .scoreboard-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.82rem;
        font-weight: 700;
        color: var(--accent);
        text-decoration: none;
        transition: all 0.2s ease;
        padding: 0.4rem 0;
    }

    .scoreboard-link i {
        transition: transform 0.25s ease;
    }

    .scoreboard-link:hover {
        gap: 0.65rem;
    }

    .scoreboard-link:hover i.fa-arrow-right {
        transform: translateX(3px);
    }

    /* No-results filter message */
    .no-filter-results {
        display: none;
        text-align: center;
        padding: 3rem 2rem;
        color: var(--fg-secondary);
        font-size: 0.95rem;
    }

    .no-filter-results i {
        font-size: 2rem;
        opacity: 0.3;
        display: block;
        margin-bottom: 0.75rem;
    }

    /* ========== ARCHIVE CARDS ========== */
    .archive-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 1.25rem;
    }

    .archive-card {
        background: var(--card-bg);
        border: 2px solid var(--card-border);
        border-radius: 20px;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .archive-card::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent) 0%, transparent 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .archive-card:hover {
        border-color: var(--accent);
        transform: translateY(-4px);
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.1);
    }

    .archive-card:hover::after {
        opacity: 1;
    }

    .archive-icon-row {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .archive-icon {
        width: 44px;
        height: 44px;
        border-radius: 13px;
        background: var(--accent-light);
        color: var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        flex-shrink: 0;
        transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .archive-card:hover .archive-icon {
        background: var(--accent);
        color: #fff;
        transform: rotate(-8deg) scale(1.08);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
    }

    .archive-filename {
        font-size: 0.85rem;
        font-weight: 700;
        color: var(--fg);
        word-break: break-word;
        line-height: 1.35;
    }

    .archive-meta-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
    }

    .meta-chip {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.75rem;
        color: var(--fg-secondary);
    }

    .meta-chip i {
        font-size: 0.65rem;
        opacity: 0.5;
    }

    /* Expiry progress bar */
    .expiry-bar-wrap {
        grid-column: 1 / -1;
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
    }

    .expiry-label {
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.72rem;
        font-weight: 600;
        color: var(--accent);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .expiry-label.expired {
        color: var(--one-dark-red, #d43b52);
    }

    .expiry-track {
        height: 5px;
        border-radius: 10px;
        background: var(--card-border);
        overflow: hidden;
    }

    .expiry-fill {
        height: 100%;
        border-radius: 10px;
        background: var(--accent);
        transition: width 1s linear, background 0.5s ease;
        min-width: 2px;
    }

    .expiry-fill.low {
        background: #e5c07b;
    }

    .expiry-fill.critical {
        background: var(--one-dark-red, #d43b52);
    }

    .expiry-fill.gone {
        width: 0 !important;
        background: var(--one-dark-red, #d43b52);
    }

    .archive-actions {
        display: flex;
        gap: 0.6rem;
        padding-top: 0.75rem;
        border-top: 1px solid var(--card-border);
    }

    .action-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        padding: 0.5rem 1rem;
        border: 2px solid var(--card-border);
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.25s ease;
        text-decoration: none;
        background: var(--card-bg);
        color: var(--fg);
    }

    .action-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
        background: var(--accent-light);
        transform: translateY(-1px);
    }

    .action-btn.download {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent);
    }

    .action-btn.download:hover {
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.15);
        color: #fff;
    }

    .action-btn.danger {
        color: var(--one-dark-red, #d43b52);
        border-color: transparent;
        background: transparent;
    }

    .action-btn.danger:hover {
        background: rgba(224, 108, 117, 0.1);
        border-color: rgba(224, 108, 117, 0.3);
        color: var(--one-dark-red, #d43b52);
    }

    /* ========== EMPTY STATE ========== */
    .empty-state {
        text-align: center;
        padding: 4.5rem 2rem;
        background: var(--card-bg);
        border: 2px dashed var(--card-border);
        border-radius: 24px;
        position: relative;
        overflow: hidden;
    }

    .empty-state::before {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(ellipse at 50% 120%, var(--accent-light) 0%, transparent 60%);
        opacity: 0.5;
        pointer-events: none;
    }

    .empty-icon {
        width: 88px;
        height: 88px;
        border-radius: 50%;
        background: var(--accent-light);
        color: var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.2rem;
        margin: 0 auto 1.5rem;
        position: relative;
        animation: emptyPulse 3s ease-in-out infinite;
    }

    @keyframes emptyPulse {

        0%,
        100% {
            box-shadow: 0 0 0 0 var(--accent-light);
        }

        50% {
            box-shadow: 0 0 0 14px transparent;
        }
    }

    .empty-state h3 {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--fg);
        margin-bottom: 0.5rem;
        position: relative;
    }

    .empty-state p {
        color: var(--fg-secondary);
        font-size: 0.95rem;
        max-width: 400px;
        margin: 0 auto 1.75rem;
        line-height: 1.6;
        position: relative;
    }

    .empty-cta {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.8rem 1.6rem;
        background: var(--gradient);
        color: #fff;
        border: none;
        border-radius: 12px;
        font-size: 0.9rem;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
    }

    .empty-cta:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    /* ========== DELETE MODAL ========== */
    .modal-overlay {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(6px);
        z-index: 100;
        padding: 1rem;
        opacity: 0;
        transition: opacity 0.25s ease;
    }

    .modal-overlay.show {
        display: flex;
        opacity: 1;
    }

    .modal-box {
        width: min(440px, 100%);
        background: var(--card-bg);
        border: 2px solid var(--card-border);
        border-radius: 24px;
        padding: 2rem;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.25);
        animation: modalIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes modalIn {
        from {
            opacity: 0;
            transform: scale(0.92) translateY(12px);
        }

        to {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    .modal-icon {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: rgba(224, 108, 117, 0.12);
        color: var(--one-dark-red, #d43b52);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        margin-bottom: 1rem;
    }

    .modal-box h3 {
        font-size: 1.15rem;
        font-weight: 700;
        margin-bottom: 0.4rem;
    }

    .modal-box p {
        color: var(--fg-secondary);
        font-size: 0.88rem;
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }

    .modal-btns {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
    }

    .modal-btn {
        padding: 0.6rem 1.3rem;
        border-radius: 10px;
        font-size: 0.85rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 2px solid var(--card-border);
        background: var(--card-bg);
        color: var(--fg);
    }

    .modal-btn:hover {
        border-color: var(--accent);
    }

    .modal-btn.confirm-delete {
        background: var(--one-dark-red, #d43b52);
        color: #fff;
        border-color: transparent;
    }

    .modal-btn.confirm-delete:hover {
        box-shadow: 0 6px 16px rgba(224, 108, 117, 0.35);
        transform: translateY(-1px);
    }

    /* ========== TOAST ========== */
    .toast-container {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        z-index: 200;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .toast {
        background: var(--card-bg);
        border: 2px solid var(--card-border);
        border-radius: 14px;
        padding: 0.85rem 1.25rem;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--fg);
        display: flex;
        align-items: center;
        gap: 0.6rem;
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.18);
        animation: toastIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        max-width: 360px;
    }

    .toast.success {
        border-color: var(--one-dark-green, #98c379);
    }

    .toast.success i {
        color: var(--one-dark-green, #98c379);
    }

    .toast.error {
        border-color: var(--one-dark-red, #e06c75);
    }

    .toast.error i {
        color: var(--one-dark-red, #e06c75);
    }

    .toast.removing {
        animation: toastOut 0.3s ease forwards;
    }

    @keyframes toastIn {
        from {
            opacity: 0;
            transform: translateX(40px) scale(0.95);
        }

        to {
            opacity: 1;
            transform: translateX(0) scale(1);
        }
    }

    @keyframes toastOut {
        to {
            opacity: 0;
            transform: translateX(40px) scale(0.95);
        }
    }

    /* ========== STAGGER ========== */
    .match-card,
    .archive-card {
        opacity: 0;
        animation: cardReveal 0.4s ease forwards;
    }

    @keyframes cardReveal {
        from {
            opacity: 0;
            transform: translateY(16px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ========== MANAGE MODE STYLES ========== */
    .toolbar-actions {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .manage-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.55rem 1rem;
        border: 2px solid var(--card-border);
        border-radius: 11px;
        background: var(--card-bg);
        color: var(--fg-secondary);
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .manage-btn:hover {
        color: var(--fg);
        border-color: var(--fg-secondary);
    }

    .manage-btn.active {
        background: var(--bg-secondary);
        color: var(--accent);
        border-color: var(--accent);
    }

    /* Checkbox Styles */
    .match-card .select-checkbox {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 24px;
        height: 24px;
        border: 2px solid var(--fg-secondary);
        border-radius: 6px;
        background: var(--card-bg);
        cursor: pointer;
        opacity: 0;
        pointer-events: none;
        transition: all 0.2s ease;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .match-card.manage-mode .select-checkbox {
        opacity: 0.4;
        pointer-events: auto;
    }

    .match-card.manage-mode:hover .select-checkbox {
        opacity: 1;
    }

    .match-card.manage-mode.selected {
        border-color: var(--accent);
        background: var(--bg-secondary);
    }

    .match-card.manage-mode.selected .select-checkbox {
        opacity: 1;
        background: var(--accent);
        border-color: var(--accent);
        color: white;
    }

    .match-card.manage-mode.selected .select-checkbox::after {
        content: '\f00c';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        font-size: 0.8rem;
    }

    /* Tournament Badge */
    .match-badge {
        font-size: 0.7rem;
        font-weight: 700;
        padding: 2px 8px;
        border-radius: 6px;
        margin-bottom: 0.5rem;
        display: inline-block;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .match-badge.tournament {
        background: rgba(255, 215, 0, 0.15);
        color: #fbbf24;
        border: 1px solid rgba(251, 191, 36, 0.3);
    }

    .match-badge.exhibition {
        background: rgba(99, 102, 241, 0.1);
        color: var(--accent);
        border: 1px solid rgba(99, 102, 241, 0.2);
    }

    /* Floating Action Bar */
    .floating-action-bar {
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: var(--card-bg);
        border: 2px solid var(--card-border);
        padding: 1rem 1.5rem;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
        display: flex;
        align-items: center;
        gap: 1.5rem;
        z-index: 90;
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .floating-action-bar.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }

    .fab-count {
        font-weight: 700;
        color: var(--fg);
        font-size: 0.95rem;
    }

    .fab-actions {
        display: flex;
        gap: 0.75rem;
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 768px) {
        .hero-row {
            flex-direction: column;
            align-items: flex-start;
        }

        .hero-text h1 {
            font-size: 2rem;
        }

        .stat-pills {
            width: 100%;
        }

        .stat-pill {
            flex: 1;
            min-width: 0;
            padding: 0.75rem;
        }

        .stat-pill .pill-value {
            font-size: 1.5rem;
        }

        .toolbar {
            flex-direction: column;
            align-items: stretch;
        }

        .tab-bar {
            width: 100%;
        }

        .tab-item {
            flex: 1;
            justify-content: center;
            padding: 0.6rem 0.8rem;
            font-size: 0.82rem;
        }

        .search-box {
            width: 100%;
        }

        .match-grid {
            grid-template-columns: 1fr;
        }

        .archive-grid {
            grid-template-columns: 1fr;
        }

        .archive-meta-grid {
            grid-template-columns: 1fr;
        }

        .hero-deco-ball {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero -->
<section class="matches-hero">
    <div class="hero-deco-ball"></div>
    <div class="hero-row">
        <div class="hero-text">
            <h1>My Matches</h1>
            <p>Your completed matches and downloadable archives, all in one place.</p>
        </div>
        <div class="stat-pills">
            <div class="stat-pill">
                <span class="pill-value" id="match-count-pill">{{ (match_history or [])|length }}</span>
                <span class="pill-label">Matches</span>
            </div>
            <div class="stat-pill">
                <span class="pill-value">{{ (files or [])|length }}</span>
                <span class="pill-label">Archives</span>
            </div>
        </div>
    </div>
</section>

<!-- Toolbar -->
<div class="toolbar">
    <div class="tab-bar" role="tablist">
        <div class="tab-indicator" id="tab-indicator"></div>
        <button class="tab-item active" type="button" data-target="history" role="tab" aria-selected="true">
            <i class="fa-solid fa-cricket-bat-ball"></i>
            Match History
            <span class="tab-badge" id="match-count-badge">{{ (match_history or [])|length }}</span>
        </button>
        <button class="tab-item" type="button" data-target="archives" role="tab" aria-selected="false">
            <i class="fa-solid fa-box-archive"></i>
            Archives
            <span class="tab-badge">{{ (files or [])|length }}</span>
        </button>
    </div>

    <div class="toolbar-actions">
        <!-- Manage Mode Toggle (Only visible nicely on History tab via JS) -->
        <button class="manage-btn" id="manage-mode-btn" title="Manage Matches">
            <i class="fa-solid fa-list-check"></i>
            Manage
        </button>

        <div class="search-box" id="search-box">
            <i class="fa-solid fa-magnifying-glass search-icon"></i>
            <input type="text" id="search-input" placeholder="Search by team name..." autocomplete="off"
                spellcheck="false">
            <button class="clear-search" id="clear-search" type="button" title="Clear"><i
                    class="fa-solid fa-xmark"></i></button>
        </div>
    </div>
</div>

<!-- Match History Panel -->
<section id="panel-history" class="panel active" role="tabpanel">
    {% if match_history and match_history|length > 0 %}
    <div class="match-grid" id="match-grid">
        {% for match in match_history %}
        <article class="match-card" id="match-{{ match.match_id }}" data-delay="{{ loop.index0 * 0.05 }}s"
            data-teams="{{ match.home_team|lower }} {{ match.away_team|lower }}" data-match-id="{{ match.match_id }}"
            data-type="{{ 'tournament' if match.is_tournament else 'exhibition' }}">

            <!-- Selection Checkbox (Only for exhibition matches) -->
            {% if not match.is_tournament %}
            <div class="select-checkbox" onclick="toggleSelection('match-{{ match.match_id }}')"></div>
            {% endif %}

            <div class="match-card-body">
                <!-- Badge Row -->
                <div>
                    {% if match.is_tournament %}
                    <span class="match-badge tournament"><i class="fa-solid fa-trophy"></i> {{ match.tournament_name or
                        'Tournament' }}</span>
                    {% else %}
                    <span class="match-badge exhibition"><i class="fa-solid fa-cricket-bat-ball"></i> Exhibition</span>
                    {% endif %}
                </div>

                <div class="match-header">
                    <div class="match-teams">
                        {{ match.home_team }}<span class="vs">vs</span>{{ match.away_team }}
                    </div>
                    <span class="match-date-chip">
                        <i class="fa-regular fa-calendar"></i>
                        {{ match.played_at.strftime('%d %b %Y') if match.played_at else 'Unknown' }}
                    </span>
                </div>

                <div class="score-block">
                    <div class="score-row">
                        <span class="score-team-name">
                            <span class="team-initial">{{ match.home_team[:2]|upper }}</span>
                            {{ match.home_team }}
                        </span>
                        <span class="score-figures">
                            {{ match.scoreline.split(' vs ')[0].replace(match.home_team, '').strip() }}
                        </span>
                    </div>
                    <div class="score-row">
                        <span class="score-team-name">
                            <span class="team-initial">{{ match.away_team[:2]|upper }}</span>
                            {{ match.away_team }}
                        </span>
                        <span class="score-figures">
                            {{ match.scoreline.split(' vs ')[1].replace(match.away_team, '').strip() if ' vs ' in
                            match.scoreline else '' }}
                        </span>
                    </div>
                </div>

                <div class="match-result">
                    <span class="result-dot"></span>
                    {{ match.result_description }}
                </div>
            </div>

            <div class="match-footer">
                <span class="match-id">#{{ match.match_id }}</span>
                <a class="scoreboard-link" href="{{ match.scoreboard_url }}">
                    View Scoreboard
                    <i class="fa-solid fa-arrow-right"></i>
                </a>
            </div>
        </article>
        {% endfor %}
    </div>
    <div class="no-filter-results" id="no-filter-results">
        <i class="fa-solid fa-magnifying-glass"></i>
        No matches found for your search.
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="fa-solid fa-cricket-bat-ball"></i>
        </div>
        <h3>No matches yet</h3>
        <p>Complete a non-tournament match to see your history here.</p>
        <a href="{{ url_for('match_setup') }}" class="empty-cta">
            <i class="fa-solid fa-play"></i>
            Simulate a Match
        </a>
    </div>
    {% endif %}
</section>

<!-- Archives Panel -->
<section id="panel-archives" class="panel" role="tabpanel">
    {% if files and files|length > 0 %}
    <div id="archive-grid" class="archive-grid">
        {% for file in files %}
        <article class="archive-card" id="archive-{{ loop.index }}" data-delete-url="{{ file.delete_url }}"
            data-delay="{{ loop.index0 * 0.05 }}s">
            <div class="archive-icon-row">
                <div class="archive-icon">
                    <i class="fa-solid fa-file-zipper"></i>
                </div>
                <div class="archive-filename">{{ file.filename }}</div>
            </div>

            <div class="archive-meta-grid">
                <div class="meta-chip">
                    <i class="fa-regular fa-calendar"></i>
                    Created {{ file.created_at.strftime('%d %b %Y') if file.created_at else 'Unknown' }}
                </div>
                <div class="meta-chip">
                    <i class="fa-regular fa-clock"></i>
                    Expires {{ file.expires_at.strftime('%d %b %Y') if file.expires_at else 'Unknown' }}
                </div>
                <div class="expiry-bar-wrap" data-created="{{ file.created_at.isoformat() if file.created_at else '' }}"
                    data-expire="{{ file.expires_at.isoformat() if file.expires_at else '' }}">
                    <div class="expiry-label">
                        <span class="el-left"><i class="fa-solid fa-hourglass-half"></i> <span
                                class="cd-text">--</span></span>
                        <span class="el-pct"></span>
                    </div>
                    <div class="expiry-track">
                        <div class="expiry-fill" style="width: 100%"></div>
                    </div>
                </div>
            </div>

            <div class="archive-actions">
                <a class="action-btn download" href="{{ file.download_url }}" download>
                    <i class="fa-solid fa-download"></i>
                    Download
                </a>
                <button class="action-btn danger" type="button" onclick="openDeleteModal('archive-{{ loop.index }}')">
                    <i class="fa-solid fa-trash-can"></i>
                    Delete
                </button>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="fa-solid fa-box-archive"></i>
        </div>
        <h3>No archives available</h3>
        <p>Archives are kept for 7 days after creation. Complete a match and export it to see archives here.</p>
    </div>
    {% endif %}
</section>

<!-- Floating Action Bar for Deletion -->
<div class="floating-action-bar" id="floating-bar">
    <div class="fab-count"><span id="selected-count">0</span> matches selected</div>
    <div class="fab-actions">
        <button class="action-btn" onclick="cancelSelection()">Cancel</button>
        <button class="action-btn danger" onclick="openBulkDeleteModal()">
            <i class="fa-solid fa-trash-can"></i> Delete
        </button>
    </div>
</div>

<!-- Delete Modal (Shared) -->
<div id="delete-modal" class="modal-overlay" role="dialog" aria-modal="true">
    <div class="modal-box">
        <div class="modal-icon">
            <i class="fa-solid fa-triangle-exclamation"></i>
        </div>
        <h3 id="delete-modal-title">Delete this item?</h3>
        <p id="delete-modal-text">This action is permanent. The item will be removed from the server.</p>
        <div class="modal-btns">
            <button type="button" class="modal-btn" onclick="closeDeleteModal()">Cancel</button>
            <button type="button" class="modal-btn confirm-delete" id="confirm-delete-btn">
                <i class="fa-solid fa-trash-can"></i> Delete
            </button>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>
{% endblock %}

{% block extra_js %}
<script>
    (function () {
        var deleteModal = document.getElementById('delete-modal');
        var pendingDeleteCard = null; // For single archive delete
        var isBulkDelete = false; // Flag for bulk delete

        // ============ Stagger Animation Fix ============
        document.querySelectorAll('.match-card[data-delay], .archive-card[data-delay]').forEach(card => {
            card.style.animationDelay = card.getAttribute('data-delay');
        });

        // ============ Mange Mode Logic ============
        var manageBtn = document.getElementById('manage-mode-btn');
        var isManageMode = false;
        var selectedMatches = new Set();
        var floatingBar = document.getElementById('floating-bar');

        // Toggle Manage Mode
        if (manageBtn) {
            manageBtn.addEventListener('click', function () {
                isManageMode = !isManageMode;
                this.classList.toggle('active', isManageMode);
                this.innerHTML = isManageMode
                    ? '<i class="fa-solid fa-check"></i> Done'
                    : '<i class="fa-solid fa-list-check"></i> Manage';

                // Toggle class on all exhibition cards
                document.querySelectorAll('.match-card[data-type="exhibition"]').forEach(card => {
                    card.classList.toggle('manage-mode', isManageMode);
                });

                if (!isManageMode) {
                    cancelSelection();
                }
            });
        }

        // Toggle Selection of specific card
        window.toggleSelection = function (cardId) {
            if (!isManageMode) return;

            var card = document.getElementById(cardId);
            var matchId = card.getAttribute('data-match-id');

            if (selectedMatches.has(matchId)) {
                selectedMatches.delete(matchId);
                card.classList.remove('selected');
            } else {
                selectedMatches.add(matchId);
                card.classList.add('selected');
            }

            updateFloatingBar();
        };

        // Update Floating Bar UI
        function updateFloatingBar() {
            var count = selectedMatches.size;
            document.getElementById('selected-count').textContent = count;

            if (count > 0) {
                floatingBar.classList.add('show');
            } else {
                floatingBar.classList.remove('show');
            }
        }

        // Cancel Selection
        window.cancelSelection = function () {
            selectedMatches.clear();
            document.querySelectorAll('.match-card.selected').forEach(c => c.classList.remove('selected'));
            updateFloatingBar();

            // Don't turn off manage mode if just cancelling selection, 
            // unless called from manage button toggle
        };

        // Open Bulk Delete Modal
        window.openBulkDeleteModal = function () {
            if (selectedMatches.size === 0) return;

            isBulkDelete = true;
            document.getElementById('delete-modal-title').textContent = `Delete ${selectedMatches.size} Matches?`;
            document.getElementById('delete-modal-text').innerHTML =
                `You are about to delete <b>${selectedMatches.size}</b> matches.<br>This will <b>reverse</b> their statistics from player records. This action cannot be undone.`;

            deleteModal.classList.add('show');
        };

        // ============ Sliding Tab Indicator ============
        function positionIndicator() {
            var active = document.querySelector('.tab-item.active');
            var indicator = document.getElementById('tab-indicator');
            if (!active || !indicator) return;
            indicator.style.width = active.offsetWidth + 'px';
            indicator.style.left = active.offsetLeft + 'px';
        }

        positionIndicator();
        window.addEventListener('resize', positionIndicator);

        document.querySelectorAll('.tab-item').forEach(function (btn) {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.tab-item').forEach(function (b) {
                    b.classList.remove('active');
                    b.setAttribute('aria-selected', 'false');
                });
                btn.classList.add('active');
                btn.setAttribute('aria-selected', 'true');
                positionIndicator();

                document.querySelectorAll('.panel').forEach(function (p) {
                    p.classList.remove('active');
                });
                var target = btn.getAttribute('data-target');
                document.getElementById('panel-' + target).classList.add('active');

                // Show/hide search box & manage btn based on tab
                var searchBox = document.getElementById('search-box');
                var mngBtn = document.getElementById('manage-mode-btn');

                if (target === 'history') {
                    if (searchBox) searchBox.style.display = '';
                    if (mngBtn) mngBtn.style.display = '';
                } else {
                    if (searchBox) searchBox.style.display = 'none';
                    if (mngBtn) mngBtn.style.display = 'none';
                    // Also exit manage mode if switching tabs
                    if (isManageMode) manageBtn.click();
                }
            });
        });

        // ============ Search / Filter ============
        var searchInput = document.getElementById('search-input');
        var clearBtn = document.getElementById('clear-search');
        var searchBox = document.getElementById('search-box');

        if (searchInput) {
            searchInput.addEventListener('input', function () {
                var query = this.value.toLowerCase().trim();
                searchBox.classList.toggle('has-query', query.length > 0);
                filterCards(query);
            });
        }

        if (clearBtn) {
            clearBtn.addEventListener('click', function () {
                searchInput.value = '';
                searchBox.classList.remove('has-query');
                filterCards('');
                searchInput.focus();
            });
        }

        function filterCards(query) {
            var cards = document.querySelectorAll('.match-card');
            var noResults = document.getElementById('no-filter-results');
            var visibleCount = 0;

            cards.forEach(function (card) {
                var teams = card.getAttribute('data-teams') || '';
                var visible = !query || teams.indexOf(query) !== -1;
                card.style.display = visible ? '' : 'none';
                if (visible) visibleCount++;
            });

            if (noResults) {
                noResults.style.display = (cards.length > 0 && visibleCount === 0) ? 'block' : 'none';
            }
        }

        // ============ Expiry Bars & Countdown ============
        function tickExpiry() {
            var bars = document.querySelectorAll('.expiry-bar-wrap[data-expire]');
            var now = Date.now();

            bars.forEach(function (wrap) {
                var createdRaw = wrap.getAttribute('data-created');
                var expireRaw = wrap.getAttribute('data-expire');
                var created = createdRaw ? Date.parse(createdRaw) : NaN;
                var expire = expireRaw ? Date.parse(expireRaw) : NaN;
                var cdText = wrap.querySelector('.cd-text');
                var pctSpan = wrap.querySelector('.el-pct');
                var fill = wrap.querySelector('.expiry-fill');
                var label = wrap.querySelector('.expiry-label');

                if (isNaN(expire)) {
                    if (cdText) cdText.textContent = 'Unknown';
                    return;
                }

                var left = expire - now;
                var total = isNaN(created) ? 7 * 86400000 : (expire - created);
                var pct = total > 0 ? Math.max(0, Math.min(100, (left / total) * 100)) : 0;

                if (cdText) cdText.textContent = left > 0 ? fmtDuration(left) : 'Expired';
                if (pctSpan) pctSpan.textContent = left > 0 ? Math.round(pct) + '%' : '';
                if (label) label.classList.toggle('expired', left <= 0);

                if (fill) {
                    fill.style.width = Math.max(0, pct) + '%';
                    fill.classList.remove('low', 'critical', 'gone');
                    if (left <= 0) fill.classList.add('gone');
                    else if (pct < 15) fill.classList.add('critical');
                    else if (pct < 35) fill.classList.add('low');
                }
            });
        }

        function fmtDuration(ms) {
            if (ms <= 0) return 'Expired';
            var s = Math.floor(ms / 1000);
            var d = Math.floor(s / 86400);
            var h = Math.floor((s % 86400) / 3600);
            var m = Math.floor((s % 3600) / 60);
            var sec = s % 60;
            var parts = [];
            if (d) parts.push(d + 'd');
            if (h) parts.push(h + 'h');
            if (m) parts.push(m + 'm');
            parts.push(sec + 's');
            return parts.join(' ');
        }

        tickExpiry();
        setInterval(tickExpiry, 1000);

        // ============ Toast Notifications ============
        function showToast(message, type) {
            var container = document.getElementById('toast-container');
            if (!container) return;
            var icon = type === 'success' ? 'fa-circle-check' : 'fa-circle-xmark';
            var toast = document.createElement('div');
            toast.className = 'toast ' + type;
            toast.innerHTML = '<i class="fa-solid ' + icon + '"></i> ' + message;
            container.appendChild(toast);

            setTimeout(function () {
                toast.classList.add('removing');
                setTimeout(function () { toast.remove(); }, 300);
            }, 3500);
        }

        // ============ Delete Archive Modal ============
        window.openDeleteModal = function (cardId) {
            isBulkDelete = false;
            pendingDeleteCard = document.getElementById(cardId);
            document.getElementById('delete-modal-title').textContent = "Delete this archive?";
            document.getElementById('delete-modal-text').textContent = "This action is permanent. The archive file will be removed from the server.";
            deleteModal.classList.add('show');
        };

        window.closeDeleteModal = function () {
            pendingDeleteCard = null;
            deleteModal.classList.remove('show');
        };

        document.getElementById('confirm-delete-btn').addEventListener('click', async function () {
            var btn = this;
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Deleting...';

            try {
                if (isBulkDelete) {
                    // BULK DELETE FLOW
                    var matchIds = Array.from(selectedMatches);
                    var response = await fetch('/matches/delete-multiple', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ match_ids: matchIds })
                    });

                    if (!response.ok) {
                        throw new Error("Failed to delete matches");
                    }

                    var result = await response.json();

                    // Remove deleted cards from DOM
                    matchIds.forEach(id => {
                        var card = document.getElementById('match-' + id);
                        if (card) {
                            card.style.transition = 'all 0.3s ease';
                            card.style.transform = 'scale(0.9) translateY(10px)';
                            card.style.opacity = '0';
                            setTimeout(() => card.remove(), 300);
                        }
                    });

                    showToast(`Successfully deleted ${result.deleted_count} matches`, 'success');

                    // Update Badge Counts
                    setTimeout(() => {
                        var currentCount = parseInt(document.getElementById('match-count-pill').innerText) || 0;
                        var newCount = Math.max(0, currentCount - result.deleted_count);
                        document.getElementById('match-count-pill').innerText = newCount;
                        document.getElementById('match-count-badge').innerText = newCount;

                        // Check for empty state
                        if (newCount === 0) {
                            location.reload();
                        }
                    }, 350);

                    cancelSelection();
                    closeDeleteModal();

                    // Exit manage mode
                    manageBtn.click();

                } else {
                    // ARCHIVE DELETE FLOW (Existing)
                    if (!pendingDeleteCard) return;
                    var deleteUrl = pendingDeleteCard.getAttribute('data-delete-url');

                    var response = await fetch(deleteUrl, {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    if (!response.ok) {
                        var errData = await response.json().catch(function () { return {}; });
                        showToast('Failed to delete: ' + (errData.error || response.statusText), 'error');
                        closeDeleteModal();
                    } else {
                        pendingDeleteCard.style.transition = 'all 0.35s ease';
                        pendingDeleteCard.style.opacity = '0';
                        pendingDeleteCard.style.transform = 'scale(0.92) translateY(8px)';

                        setTimeout(function () {
                            pendingDeleteCard.remove();
                            if (!document.querySelector('.archive-card')) {
                                var grid = document.getElementById('archive-grid');
                                if (grid) {
                                    grid.outerHTML =
                                        '<div class="empty-state">' +
                                        '<div class="empty-icon"><i class="fa-solid fa-box-archive"></i></div>' +
                                        '<h3>No archives available</h3>' +
                                        '<p>Archives are kept for 7 days after creation.</p>' +
                                        '</div>';
                                }
                            }
                            showToast('Archive deleted successfully', 'success');
                            closeDeleteModal();
                        }, 350);
                    }
                }
            } catch (err) {
                console.error("Delete operation failed:", err);
                showToast('Unexpected error while deleting. Check console for details.', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-trash-can"></i> Delete';
            }
        });

        deleteModal.addEventListener('click', function (e) {
            if (e.target === deleteModal) closeDeleteModal();
        });

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') closeDeleteModal();
        });
    })();
</script>
{% endblock %}