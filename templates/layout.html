<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}SimCricketX{% endblock %}</title>

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/shared.css') }}">
    <!-- Global CSS Variables -->
    <style>
        :root {
            /* Light Theme - Minimalistic */
            --bg: #ffffff;
            --bg-secondary: #f8f9fa;
            --fg: #1a1a1a;
            --fg-secondary: #666666;
            --card-bg: #ffffff;
            --card-border: #e2e4e8;
            --accent: #24292f;
            /* Very dark grey almost black for minimal look */
            --accent-hover: #000000;
            --accent-light: #f3f4f6;
            --shadow: rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.08);
            --nav-height: 64px;
            --border-radius: 8px;
            /* Slightly sharper for minimalism */
            --transition: all 0.2s ease;
            --gradient: linear-gradient(135deg, #24292f 0%, #4a5568 100%);
        }

        [data-theme="dark"] {
            /* Dark Theme - VS Code One Dark Pro */
            --bg: #282c34;
            --bg-secondary: #21252b;
            --fg: #abb2bf;
            --fg-secondary: #5c6370;
            --card-bg: #21252b;
            --card-border: #3e4451;
            /* One Dark selection/border color */
            --accent: #61afef;
            /* One Dark Blue */
            --accent-hover: #528bcc;
            --accent-light: rgba(97, 175, 239, 0.15);
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 60px rgba(97, 175, 239, 0.1);
            --gradient: linear-gradient(135deg, #61afef 0%, #c678dd 100%);
            /* One Dark Blue to Purple */

            /* One Dark Pro Extended Palette */
            --one-dark-red: #e06c75;
            --one-dark-green: #98c379;
            --one-dark-yellow: #e5c07b;
            --one-dark-blue: #61afef;
            --one-dark-purple: #c678dd;
            --one-dark-cyan: #56b6c2;
            --one-dark-orange: #d19a66;
        }

        /* Reset & Base */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg);
            color: var(--fg);
            line-height: 1.5;
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            cursor: pointer;
            font-family: inherit;
        }

        /* Navigation */
        .navbar {
            height: var(--nav-height);
            background: var(--card-bg);
            border-bottom: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 1px 2px var(--shadow);
            backdrop-filter: blur(8px);
        }

        .nav-brand {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--fg);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-brand i {
            color: var(--accent);
        }

        .nav-logo-text {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .nav-items {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: var(--bg);
            border: 1px solid var(--card-border);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--fg-secondary);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            color: var(--accent);
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .github-star-btn {
            position: relative;
            overflow: visible;
        }

        .github-star-btn .fa-star {
            position: absolute;
            right: 6px;
            bottom: 6px;
            font-size: 0.55rem;
            color: #f59e0b;
            background: var(--card-bg);
            border-radius: 50%;
            padding: 1px;
            line-height: 1;
        }

        .github-star-coachmark {
            position: fixed;
            z-index: 3000;
            max-width: 280px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 30px var(--shadow);
            border-radius: 12px;
            padding: 0.75rem 0.9rem;
            color: var(--fg);
            font-size: 0.85rem;
            line-height: 1.35;
            opacity: 0;
            transform: translateY(-6px);
            pointer-events: none;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .github-star-coachmark.show {
            opacity: 1;
            transform: translateY(0);
        }

        .github-star-coachmark::before {
            content: '';
            position: absolute;
            top: -6px;
            right: 24px;
            width: 12px;
            height: 12px;
            background: var(--card-bg);
            border-left: 1px solid var(--card-border);
            border-top: 1px solid var(--card-border);
            transform: rotate(45deg);
        }

        .github-star-coachmark a {
            color: var(--accent);
            font-weight: 700;
            text-decoration: none;
        }

        .github-star-coachmark a:hover {
            text-decoration: underline;
        }

        /* ===== User Profile Dropdown ===== */
        .profile-dropdown-wrapper {
            position: relative;
        }

        .profile-trigger {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.75rem;
            background: var(--bg);
            border: 1px solid var(--card-border);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            color: var(--fg);
        }

        .profile-trigger:hover {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .profile-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .profile-name {
            font-size: 0.9rem;
            font-weight: 600;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .profile-trigger i {
            font-size: 0.7rem;
            color: var(--fg-secondary);
            transition: transform 0.3s ease;
        }

        .profile-trigger.active i {
            transform: rotate(180deg);
        }

        .profile-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            width: 320px;
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow: hidden;
        }

        .profile-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .profile-header {
            padding: 1.5rem;
            background: linear-gradient(135deg,
                    var(--accent-light) 0%,
                    transparent 100%);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .profile-avatar-large {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .profile-info {
            flex: 1;
            min-width: 0;
        }

        .profile-display-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--fg);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .profile-email {
            font-size: 0.8rem;
            color: var(--fg-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .profile-stats {
            padding: 1rem 1.5rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--fg-secondary);
        }

        .stat-item i {
            color: var(--accent);
            font-size: 0.9rem;
            width: 16px;
        }

        .profile-divider {
            height: 1px;
            background: var(--card-border);
            margin: 0 1rem;
        }

        .profile-actions {
            padding: 0.75rem 0.5rem;
        }

        .profile-action-item {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--fg);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            font-family: inherit;
        }

        .profile-action-item:hover {
            background: var(--accent-light);
            color: var(--accent);
        }

        .profile-action-item i {
            width: 20px;
            color: var(--fg-secondary);
        }

        .profile-action-item:hover i {
            color: var(--accent);
        }

        .profile-signout {
            color: #ef4444;
        }

        .profile-signout:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .profile-signout:hover i {
            color: #dc2626;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .profile-name {
                display: none;
            }

            .profile-dropdown {
                width: 280px;
                right: -1rem;
            }
        }

        /* Content Wrapper */
        .main-container {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* ===== PREMIUM CRICKET THEME ===== */

        /* Cricket Field Background Animation */
        @keyframes stadiumPulse {

            0%,
            100% {
                opacity: 0.03;
                transform: scale(1);
            }

            50% {
                opacity: 0.06;
                transform: scale(1.02);
            }
        }

        @keyframes ballBounce {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            25% {
                transform: translateY(-20px) rotate(90deg);
            }

            50% {
                transform: translateY(0) rotate(180deg);
            }

            75% {
                transform: translateY(-10px) rotate(270deg);
            }
        }

        @keyframes pitchLine {
            0% {
                stroke-dashoffset: 1000;
            }

            100% {
                stroke-dashoffset: 0;
            }
        }

        /* Hero Section with Cricket Field */
        .hero-section {
            position: relative;
            text-align: center;
            padding: 6rem 0 5rem;
            margin-bottom: 4rem;
            overflow: hidden;
            background:
                radial-gradient(ellipse at center, rgba(34, 139, 34, 0.05) 0%, transparent 70%),
                linear-gradient(180deg, var(--bg) 0%, rgba(34, 139, 34, 0.02) 100%);
        }

        /* Cricket Field Pattern */
        .hero-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            background:
                repeating-linear-gradient(90deg, transparent, transparent 49px, rgba(34, 139, 34, 0.03) 49px, rgba(34, 139, 34, 0.03) 50px),
                repeating-linear-gradient(0deg, transparent, transparent 49px, rgba(34, 139, 34, 0.03) 49px, rgba(34, 139, 34, 0.03) 50px);
            animation: stadiumPulse 8s ease-in-out infinite;
            z-index: 0;
            opacity: 0.5;
        }

        /* Cricket Ball Decorative Element */
        .cricket-ball {
            position: absolute;
            top: 10%;
            right: 5%;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #DC143C, #8B0000);
            border-radius: 50%;
            box-shadow:
                inset -5px -5px 10px rgba(0, 0, 0, 0.3),
                0 5px 20px rgba(220, 20, 60, 0.2);
            animation: ballBounce 6s ease-in-out infinite;
            z-index: 1;
            opacity: 0.15;
        }

        .cricket-ball::before,
        .cricket-ball::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            left: 50%;
            transform: translateX(-50%);
        }

        .cricket-ball::before {
            transform: translateX(-50%) rotate(20deg);
        }

        .cricket-ball::after {
            transform: translateX(-50%) rotate(-20deg);
        }

        /* Stumps Decorative Elements */
        .stumps-left,
        .stumps-right {
            position: absolute;
            bottom: 20%;
            width: 4px;
            height: 80px;
            background: linear-gradient(180deg, #8B4513, #654321);
            opacity: 0.08;
            z-index: 1;
        }

        .stumps-left {
            left: 8%;
            transform: rotate(-5deg);
        }

        .stumps-right {
            right: 8%;
            transform: rotate(5deg);
        }

        .stumps-left::before,
        .stumps-left::after,
        .stumps-right::before,
        .stumps-right::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #8B4513, #654321);
        }

        .stumps-left::before,
        .stumps-right::before {
            left: 12px;
        }

        .stumps-left::after,
        .stumps-right::after {
            left: 24px;
        }

        .hero-pretitle {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: block;
            position: relative;
            z-index: 2;
        }

        .hero-pretitle::before,
        .hero-pretitle::after {
            content: 'üèè';
            margin: 0 0.5rem;
            opacity: 0.6;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 1.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1.1;
            letter-spacing: -0.03em;
            position: relative;
            z-index: 2;
            text-shadow: 0 0 40px rgba(59, 130, 246, 0.1);
        }

        .hero-subtitle {
            font-size: 1.3rem;
            color: var(--fg-secondary);
            max-width: 700px;
            margin: 0 auto 4rem;
            line-height: 1.7;
            position: relative;
            z-index: 2;
            font-weight: 400;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-bottom: 5rem;
        }

        /* Cricket-Themed Cards */
        .dashboard-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 24px;
            padding: 2.5rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 260px;
            position: relative;
            overflow: hidden;
        }

        /* Cricket Pitch Stripe Effect on Cards */
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: repeating-linear-gradient(90deg,
                    var(--accent) 0px,
                    var(--accent) 20px,
                    transparent 20px,
                    transparent 40px);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .dashboard-card:hover::before {
            opacity: 0.3;
        }

        /* Cricket Field Pattern on Hover */
        .dashboard-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(34, 139, 34, 0.03) 0%, transparent 50%),
                linear-gradient(135deg, var(--accent-light) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 0;
            pointer-events: none;
        }

        .dashboard-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow:
                0 20px 50px rgba(0, 0, 0, 0.12),
                0 0 0 2px var(--accent);
            border-color: var(--accent);
        }

        .dashboard-card:hover::after {
            opacity: 1;
        }

        .card-content {
            position: relative;
            z-index: 1;
        }

        /* Cricket-Themed Icon Wrapper */
        .card-icon-wrapper {
            width: 72px;
            height: 72px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--bg) 0%, var(--accent-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-size: 2rem;
            margin-bottom: 2rem;
            border: 2px solid var(--card-border);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        /* Cricket Ball Stitching Pattern on Icons */
        .card-icon-wrapper::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(45deg, transparent 48%, rgba(220, 20, 60, 0.1) 48%, rgba(220, 20, 60, 0.1) 52%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, rgba(220, 20, 60, 0.1) 48%, rgba(220, 20, 60, 0.1) 52%, transparent 52%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .dashboard-card:hover .card-icon-wrapper {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
            transform: rotate(5deg) scale(1.1);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .dashboard-card:hover .card-icon-wrapper::before {
            opacity: 0.3;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--fg);
            margin-bottom: 1rem;
            letter-spacing: -0.01em;
        }

        .card-description {
            color: var(--fg-secondary);
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 0;
        }

        .card-action {
            position: relative;
            z-index: 1;
            margin-top: 2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--accent);
            opacity: 0;
            transform: translateX(-15px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dashboard-card:hover .card-action {
            opacity: 1;
            transform: translateX(0);
        }

        .card-action i {
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover .card-action i {
            transform: translateX(5px);
        }

        /* Buttons */
        .btn-primary {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.875rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px var(--shadow);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-hover);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--fg);
            border: 2px solid var(--card-border);
            padding: 0.875rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-light);
        }

        /* Form Inputs */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--card-border);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--fg);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.8rem;
            }

            .hero-subtitle {
                font-size: 1.1rem;
            }

            .cricket-ball {
                width: 40px;
                height: 40px;
                top: 5%;
                right: 5%;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .main-container {
                padding: 1rem;
            }
        }

        /* Backup Modal ‚Äî uses design tokens from theme_manage.css */
        .backup-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay-bg);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 1rem;
        }

        .backup-modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .backup-modal-content {
            background: var(--bg-raised);
            border: 1px solid var(--border-light);
            padding: 2.5rem;
            border-radius: var(--radius-lg);
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow-lg);
            transform: scale(0.95);
            transition: transform 0.3s var(--ease-elastic);
        }

        .backup-modal.active .backup-modal-content {
            transform: scale(1);
        }

        .backup-modal-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: var(--brand-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
        }

        .backup-modal-title {
            font-family: var(--font-sans);
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 0.35rem;
        }

        .backup-modal-desc {
            font-size: 0.88rem;
            color: var(--text-muted);
            margin-bottom: 1.75rem;
            line-height: 1.5;
        }

        .backup-input-group {
            text-align: left;
            margin-bottom: 1.5rem;
        }

        .backup-input-label {
            display: block;
            font-family: var(--font-sans);
            font-size: 0.78rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: 0.5rem;
        }

        .backup-input-wrap {
            position: relative;
        }

        .backup-input-wrap .input-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.85rem;
            pointer-events: none;
            transition: color 0.2s ease;
        }

        .backup-input-wrap:focus-within .input-icon {
            color: var(--brand-primary);
        }

        .backup-input {
            width: 100%;
            padding: 0.875rem 3rem 0.875rem 2.6rem;
            font-family: var(--font-mono);
            font-size: 0.88rem;
            background: var(--bg-surface);
            color: var(--text-main);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            outline: none;
            transition: all 0.2s ease;
        }

        .backup-input::placeholder {
            color: var(--text-muted);
            opacity: 0.6;
        }

        .backup-input:focus {
            border-color: var(--border-focused);
            box-shadow: 0 0 0 3px var(--accent-light), var(--shadow-xs);
        }

        .backup-input.has-error {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .backup-input.has-error:focus {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.15);
        }

        .backup-vis-toggle {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-muted);
            font-size: 0.88rem;
            padding: 0.35rem 0.55rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .backup-vis-toggle:hover {
            color: var(--brand-primary);
            background: var(--accent-light);
            border-color: var(--border-light);
        }

        .backup-feedback {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            margin-top: 0.6rem;
            font-size: 0.8rem;
            font-weight: 500;
            line-height: 1.4;
            min-height: 1.4em;
            opacity: 0;
            transform: translateY(-4px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .backup-feedback.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .backup-feedback.error {
            color: var(--danger);
        }

        .backup-feedback.success {
            color: var(--success);
        }

        .backup-actions {
            display: flex;
            gap: 0.75rem;
        }

        .backup-btn {
            flex: 1;
            border-radius: var(--radius-full);
            padding: 0.7rem 1.5rem;
            border: 1px solid transparent;
            font-family: var(--font-sans);
            font-weight: 600;
            font-size: 0.88rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.45rem;
            transition: all 0.2s ease;
        }

        .backup-btn-ghost {
            background: var(--bg-raised);
            color: var(--text-main);
            border-color: var(--border-light);
        }

        .backup-btn-ghost:hover {
            border-color: var(--brand-primary);
            color: var(--brand-primary);
        }

        .backup-btn-primary {
            background: var(--brand-gradient);
            color: var(--text-on-accent);
            box-shadow: var(--shadow-xs);
        }

        .backup-btn-primary:hover:not(:disabled) {
            box-shadow: var(--shadow-sm), var(--shadow-glow);
            transform: translateY(-1px);
        }

        .backup-btn-primary:disabled {
            opacity: 0.55;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .backup-btn-primary .fa-spinner {
            animation: backup-spin 0.7s linear infinite;
        }

        @keyframes backup-spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme_manage.css') }}">

    {% block extra_css %}{% endblock %}
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar">
        <a href="{{ url_for('home') }}" class="nav-brand">
            <i class="fas fa-baseball-ball"></i>
            <span class="nav-logo-text">SimCricketX</span>
        </a>

        <div class="nav-items">
            {% block navbar_items %}
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('home') }}" class="theme-toggle" title="Home"><i class="fas fa-home"></i></a>
            <a href="https://github.com/Manishrdy/SimCricketX" id="github-star-nav-btn" class="theme-toggle github-star-btn"
                title="Star on GitHub" aria-label="Star SimCricketX on GitHub" target="_blank"
                rel="noopener noreferrer">
                <i class="fab fa-github" aria-hidden="true"></i>
                <i class="fas fa-star" aria-hidden="true"></i>
            </a>
            {% if current_user.is_admin %}
            <a href="{{ url_for('admin_dashboard') }}" class="theme-toggle" title="Admin Panel"
                style="background: var(--accent-light); color: var(--accent); border-color: var(--accent);">
                <i class="fas fa-shield-alt"></i>
            </a>
            <button onclick="downloadDatabase()" class="theme-toggle" title="Download Database Backup"
                style="background: var(--accent-light); color: var(--accent); border-color: var(--accent);">
                <i class="fas fa-database"></i>
            </button>
            {% endif %}

            <!-- User Profile Dropdown -->
            <div class="profile-dropdown-wrapper">
                <button class="profile-trigger" id="profileBtn">
                    <div class="profile-avatar">{{ (current_user.display_name or current_user.id)[0]|upper }}</div>
                    <span class="profile-name">{{ current_user.display_name or current_user.id.split('@')[0] }}</span>
                    <i class="fas fa-chevron-down"></i>
                </button>

                <!-- Dropdown Menu -->
                <div class="profile-dropdown" id="profileDropdown">
                    <!-- Profile Header -->
                    <div class="profile-header">
                        <div class="profile-avatar-large">{{ (current_user.display_name or current_user.id)[0]|upper }}
                        </div>
                        <div class="profile-info">
                            <div class="profile-display-name">{{ current_user.display_name or
                                current_user.id.split('@')[0] }}</div>
                            <div class="profile-email">{{ current_user.id }}</div>
                        </div>
                    </div>

                    <!-- Account Stats -->
                    <div class="profile-stats">
                        <div class="stat-item">
                            <i class="fas fa-users"></i>
                            <span>{{ user_stats.teams_count }} Teams</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-circle-play"></i>
                            <span>{{ user_stats.matches_count }} Matches</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-trophy"></i>
                            <span>{{ user_stats.tournaments_count }} Tournaments</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-calendar"></i>
                            <span>Since {{ current_user.created_at.strftime('%b %Y') if current_user.created_at else
                                'N/A' }}</span>
                        </div>
                    </div>

                    <div class="profile-divider"></div>

                    <!-- Quick Actions -->
                    <div class="profile-actions">
                        <a href="{{ url_for('manage_teams') }}" class="profile-action-item">
                            <i class="fas fa-users"></i>
                            <span>My Teams</span>
                        </a>
                        <a href="{{ url_for('my_matches') }}" class="profile-action-item">
                            <i class="fas fa-history"></i>
                            <span>Match History</span>
                        </a>
                        <a href="{{ url_for('tournaments') }}" class="profile-action-item">
                            <i class="fas fa-trophy"></i>
                            <span>Tournaments</span>
                        </a>
                        <a href="{{ url_for('my_analytics') }}" class="profile-action-item">
                            <i class="fas fa-chart-bar"></i>
                            <span>My Analytics</span>
                        </a>
                        <a href="{{ url_for('export_my_data') }}" class="profile-action-item">
                            <i class="fas fa-download"></i>
                            <span>Export My Data</span>
                        </a>
                        <button class="profile-action-item" onclick="toggleThemeFromDropdown()">
                            <i class="fas fa-moon" id="dropdownThemeIcon"></i>
                            <span>Toggle Theme</span>
                        </button>
                    </div>

                    <div class="profile-divider"></div>

                    <!-- Sign Out -->
                    <form method="POST" action="{{ url_for('logout') }}" style="margin: 0;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="profile-action-item profile-signout">
                            <i class="fas fa-right-from-bracket"></i>
                            <span>Sign Out</span>
                        </button>
                    </form>
                </div>
            </div>
            {% endif %}
            {% endblock %}
            <button id="theme-btn" class="theme-toggle" title="Toggle Theme">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </nav>


    <!-- Maintenance Mode Banner (admin only) -->
    {% if maintenance_mode and current_user.is_authenticated and current_user.is_admin %}
    <div
        style="background: linear-gradient(135deg, #f59e0b, #e67e22); color: #000; padding: 0.4rem 1rem; text-align: center; font-weight: 600; font-size: 0.82rem; display: flex; align-items: center; justify-content: center; gap: 0.75rem; z-index: 9999;">
        <i class="fas fa-cog fa-spin"></i>
        Maintenance Mode Active &mdash; Only you can access the site
        <a href="{{ url_for('admin_dashboard') }}"
            style="background: #000; color: #f59e0b; padding: 0.2rem 0.65rem; border-radius: 6px; text-decoration: none; font-size: 0.78rem;">
            <i class="fas fa-shield-alt"></i> Admin Panel
        </a>
    </div>
    {% endif %}

    <!-- Impersonation Banner -->
    {% if session.get('impersonating_from') %}
    <div
        style="background: linear-gradient(135deg, #f59e0b, #d97706); color: #000; padding: 0.5rem 1rem; text-align: center; font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; justify-content: center; gap: 0.75rem; z-index: 9999;">
        <i class="fas fa-user-secret"></i>
        Impersonating {{ current_user.id }} (Admin: {{ session.get('impersonating_from') }})
        <a href="{{ url_for('admin_stop_impersonation') }}"
            style="background: #000; color: #f59e0b; padding: 0.25rem 0.75rem; border-radius: 6px; text-decoration: none; font-size: 0.8rem;">
            <i class="fas fa-sign-out-alt"></i> Stop Impersonating
        </a>
    </div>
    {% endif %}

    <!-- Main Content -->
    <main class="main-container">
        {% block content %}{% endblock %}
    </main>

    {% if current_user.is_authenticated and session.pop('show_github_star_prompt', False) %}
    <div id="github-star-coachmark" class="github-star-coachmark" role="status" aria-live="polite">
        If you like this project, <a href="https://github.com/Manishrdy/SimCricketX" target="_blank"
            rel="noopener noreferrer">star this repo</a>.
    </div>
    {% endif %}

    <!-- Site Footer -->
    <footer
        style="text-align: center; padding: 1.25rem 1rem; font-size: 0.75rem; color: var(--fg-secondary); border-top: 1px solid var(--card-border); opacity: 0.7;">
        <span>SimCricketX</span>
        <span style="margin: 0 0.4rem;">&middot;</span>
        <a href="https://www.planetcricket.org/forums/members/manish.176972/" target="_blank" rel="noopener noreferrer"
            style="color: var(--accent); text-decoration: none; font-weight: 500;">
            <i class="fas fa-envelope" style="font-size: 0.7rem;"></i> Contact Developer
        </a>
        <span style="margin: 0 0.4rem;">&middot;</span>
        <span>v{{ app_version }}</span>
    </footer>

    {% if current_user.is_authenticated and current_user.is_admin %}
    <!-- Backup Modal -->
    <div class="backup-modal" id="backupModal">
        <div class="backup-modal-content">
            <div class="backup-modal-icon">
                <i class="fa-solid fa-database"></i>
            </div>
            <h2 class="backup-modal-title">Database Backup</h2>
            <p class="backup-modal-desc">
                Authenticate with your backup token to download the database.
            </p>
            <div class="backup-input-group">
                <label for="backup-input" class="backup-input-label">Backup Token</label>
                <div class="backup-input-wrap">
                    <i class="fa-solid fa-key input-icon"></i>
                    <input type="password" id="backup-input" class="backup-input" placeholder="Paste your token"
                        autocomplete="off" spellcheck="false">
                    <button type="button" id="backup-toggle-vis" class="backup-vis-toggle" title="Show token">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
                <div id="backup-feedback" class="backup-feedback">
                    <i class="fa-solid fa-circle-exclamation"></i>
                    <span></span>
                </div>
            </div>
            <div class="backup-actions">
                <button type="button" id="backup-cancel" class="backup-btn backup-btn-ghost">Cancel</button>
                <button type="button" id="backup-go" class="backup-btn backup-btn-primary">
                    <i class="fa-solid fa-download"></i> Download
                </button>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>

    <script>
        // Post-login GitHub star coachmark
        (function () {
            const coach = document.getElementById('github-star-coachmark');
            const target = document.getElementById('github-star-nav-btn');
            if (!coach || !target) return;

            const placeCoachmark = () => {
                const rect = target.getBoundingClientRect();
                const top = Math.min(window.innerHeight - 100, rect.bottom + 10);
                const left = Math.max(12, Math.min(window.innerWidth - coach.offsetWidth - 12, rect.right - coach.offsetWidth + 16));
                coach.style.top = `${top}px`;
                coach.style.left = `${left}px`;
            };

            requestAnimationFrame(() => {
                placeCoachmark();
                coach.classList.add('show');
                setTimeout(() => {
                    coach.classList.remove('show');
                    setTimeout(() => coach.remove(), 220);
                }, 3000);
            });

            window.addEventListener('resize', placeCoachmark);
        })();
    </script>

    <script>
        // Admin Database Backup
        function downloadDatabase() {
            const modal = document.getElementById('backupModal');
            if (!modal) return;
            const input = document.getElementById('backup-input');
            const fb = document.getElementById('backup-feedback');
            const goBtn = document.getElementById('backup-go');

            input.value = '';
            input.type = 'password';
            input.classList.remove('has-error');
            fb.classList.remove('visible', 'error', 'success');
            goBtn.disabled = false;
            goBtn.innerHTML = '<i class="fa-solid fa-download"></i> Download';

            const visBtn = document.getElementById('backup-toggle-vis');
            visBtn.querySelector('i').className = 'fa-solid fa-eye';
            visBtn.title = 'Show token';

            modal.classList.add('active');
            setTimeout(() => input.focus(), 80);
        }

        (function () {
            const modal = document.getElementById('backupModal');
            if (!modal) return;

            const input = document.getElementById('backup-input');
            const fb = document.getElementById('backup-feedback');
            const fbIcon = fb.querySelector('i');
            const fbText = fb.querySelector('span');
            const toggleBtn = document.getElementById('backup-toggle-vis');
            const cancelBtn = document.getElementById('backup-cancel');
            const goBtn = document.getElementById('backup-go');

            function showFeedback(text, type) {
                fb.className = 'backup-feedback visible ' + type;
                fbIcon.className = type === 'error'
                    ? 'fa-solid fa-circle-exclamation'
                    : 'fa-solid fa-circle-check';
                fbText.textContent = text;
                if (type === 'error') input.classList.add('has-error');
            }

            function clearFeedback() {
                fb.classList.remove('visible', 'error', 'success');
                input.classList.remove('has-error');
            }

            function closeModal() {
                modal.classList.remove('active');
            }

            async function doDownload() {
                const token = input.value.trim();
                if (!token) {
                    showFeedback('Please enter your backup token.', 'error');
                    input.focus();
                    return;
                }
                clearFeedback();

                goBtn.disabled = true;
                goBtn.innerHTML = '<i class="fa-solid fa-spinner"></i> Verifying\u2026';

                try {
                    const formData = new FormData();
                    formData.append('token', token);
                    const resp = await fetch('/admin/backup-database', {
                        method: 'POST',
                        body: formData
                    });

                    if (!resp.ok) {
                        const data = await resp.json().catch(() => null);
                        const errMsg = data?.error || (resp.status === 403
                            ? 'Invalid token. Please check and try again.'
                            : resp.status === 503
                                ? 'Backup is not configured on the server.'
                                : 'Download failed. Please try again.');
                        showFeedback(errMsg, 'error');
                        goBtn.disabled = false;
                        goBtn.innerHTML = '<i class="fa-solid fa-download"></i> Download';
                        input.focus();
                        input.select();
                        return;
                    }

                    showFeedback('Verified! Starting download\u2026', 'success');
                    const blob = await resp.blob();
                    const ts = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `cricket_sim_backup_${ts}.db`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    setTimeout(closeModal, 900);

                } catch {
                    showFeedback('Network error. Is the server running?', 'error');
                    goBtn.disabled = false;
                    goBtn.innerHTML = '<i class="fa-solid fa-download"></i> Download';
                }
            }

            toggleBtn.addEventListener('click', () => {
                const hidden = input.type === 'password';
                input.type = hidden ? 'text' : 'password';
                toggleBtn.querySelector('i').className = hidden ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye';
                toggleBtn.title = hidden ? 'Hide token' : 'Show token';
            });

            cancelBtn.addEventListener('click', closeModal);
            goBtn.addEventListener('click', doDownload);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') doDownload();
            });
            input.addEventListener('input', clearFeedback);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.classList.contains('active')) closeModal();
            });
        })();
    </script>

    <script>
        // Profile Dropdown Toggle
        (function () {
            const profileBtn = document.getElementById('profileBtn');
            const profileDropdown = document.getElementById('profileDropdown');

            if (!profileBtn || !profileDropdown) return;

            // Toggle dropdown
            profileBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                profileBtn.classList.toggle('active');
                profileDropdown.classList.toggle('active');
            });

            // Close when clicking outside
            document.addEventListener('click', function (e) {
                if (!profileDropdown.contains(e.target) && e.target !== profileBtn && !profileBtn.contains(e.target)) {
                    profileBtn.classList.remove('active');
                    profileDropdown.classList.remove('active');
                }
            });

            // Close on escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && profileDropdown.classList.contains('active')) {
                    profileBtn.classList.remove('active');
                    profileDropdown.classList.remove('active');
                }
            });
        })();
    </script>

    <script>
        // Theme Logic
        (function () {
            const themeBtn = document.getElementById('theme-btn');
            const icon = themeBtn.querySelector('i');
            const dropdownIcon = document.getElementById('dropdownThemeIcon');
            const html = document.documentElement;

            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';

            function applyTheme(theme) {
                html.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                const iconClass = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                icon.className = iconClass;
                // Also update dropdown icon if it exists
                if (dropdownIcon) {
                    dropdownIcon.className = iconClass;
                }
            }

            applyTheme(savedTheme);

            // Toggle handler for main button
            themeBtn.addEventListener('click', function () {
                const current = html.getAttribute('data-theme');
                const next = current === 'dark' ? 'light' : 'dark';
                applyTheme(next);
            });

            // Global function for dropdown theme toggle
            window.toggleThemeFromDropdown = function () {
                const current = html.getAttribute('data-theme');
                const next = current === 'dark' ? 'light' : 'dark';
                applyTheme(next);
            };
        })();
    </script>

    <script>
        // Auto-inject CSRF token into all fetch() POST/PUT/DELETE requests
        (function () {
            const csrfMeta = document.querySelector('meta[name="csrf-token"]');
            if (!csrfMeta) return;
            const csrfToken = csrfMeta.getAttribute('content');
            const originalFetch = window.fetch;
            window.fetch = function (url, options) {
                options = options || {};
                const method = (options.method || 'GET').toUpperCase();
                if (method !== 'GET' && method !== 'HEAD') {
                    options.headers = options.headers || {};
                    if (options.headers instanceof Headers) {
                        if (!options.headers.has('X-CSRFToken')) {
                            options.headers.set('X-CSRFToken', csrfToken);
                        }
                    } else {
                        if (!options.headers['X-CSRFToken']) {
                            options.headers['X-CSRFToken'] = csrfToken;
                        }
                    }
                }
                return originalFetch.call(this, url, options);
            };
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>

</html>
