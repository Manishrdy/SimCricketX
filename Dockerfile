# ──────────────────────────────────────────────────────────────────────────────
# 1. Base image
# ──────────────────────────────────────────────────────────────────────────────
FROM python:3.9-slim

# ──────────────────────────────────────────────────────────────────────────────
# 2. Set working directory
# ──────────────────────────────────────────────────────────────────────────────
WORKDIR /app

# ──────────────────────────────────────────────────────────────────────────────
# 3. Copy requirements first (caching benefit)
# ──────────────────────────────────────────────────────────────────────────────
COPY requirements.txt .

# ──────────────────────────────────────────────────────────────────────────────
# 4. Install Python dependencies
# ──────────────────────────────────────────────────────────────────────────────
RUN pip install --no-cache-dir -r requirements.txt

# ──────────────────────────────────────────────────────────────────────────────
# 5. Copy the rest of your project files
#     (this brings in app.py, all folders, templates, static files, utils, etc.)
# ──────────────────────────────────────────────────────────────────────────────
COPY . .

# ──────────────────────────────────────────────────────────────────────────────
# 6. Expose port 7860
#     Hugging Face Spaces expects the web service to listen on 0.0.0.0:7860
# ──────────────────────────────────────────────────────────────────────────────
EXPOSE 7860

# ──────────────────────────────────────────────────────────────────────────────
# 7. Entrypoint: run your Flask app
#
#    - Assumes that app.py calls
#        app.run(host="0.0.0.0", port=7860)
#      at the bottom, or otherwise binds to 0.0.0.0:7860.
#    - If you prefer Gunicorn, replace this CMD with something like:
#        ["gunicorn", "-w", "4", "-b", "0.0.0.0:7860", "app:app"]
# ──────────────────────────────────────────────────────────────────────────────
CMD ["python", "app.py"]
