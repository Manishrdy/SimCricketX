# ──────────────────────────────────────────────────────────────────────────────
# 1. Base image
# ──────────────────────────────────────────────────────────────────────────────
FROM python:3.9-slim

# ──────────────────────────────────────────────────────────────────────────────
# 2. Set working directory
# ──────────────────────────────────────────────────────────────────────────────
WORKDIR /app

# ──────────────────────────────────────────────────────────────────────────────
# 3. Copy requirements first (for caching)
# ──────────────────────────────────────────────────────────────────────────────
COPY requirements.txt .

# ──────────────────────────────────────────────────────────────────────────────
# 4. Install Python dependencies
# ──────────────────────────────────────────────────────────────────────────────
RUN pip install --no-cache-dir -r requirements.txt

# ──────────────────────────────────────────────────────────────────────────────
# 5. Copy rest of the project files (including logs/ directory)
# ──────────────────────────────────────────────────────────────────────────────
COPY . .

# ──────────────────────────────────────────────────────────────────────────────
# 6. Ensure the logs directory exists and is writable
# ──────────────────────────────────────────────────────────────────────────────
RUN mkdir -p /app/logs
RUN chmod -R 0777 /app/logs

# ──────────────────────────────────────────────────────────────────────────────
# 7. Expose the port that Flask will listen on
# ──────────────────────────────────────────────────────────────────────────────
EXPOSE 7860

# ──────────────────────────────────────────────────────────────────────────────
# 8. Start the Flask app
# ──────────────────────────────────────────────────────────────────────────────
CMD ["python", "app.py"]
